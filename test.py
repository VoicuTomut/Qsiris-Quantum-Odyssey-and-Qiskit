"""

"""
import json
import numpy as np

from qiskit import QuantumRegister, QuantumCircuit
from qiskit import Aer, execute
from qiskit.visualization import plot_histogram

from project_qsiris.conversion_qo_qiskit import odyssey_to_qiskit, load_oddysey_puzzle

"""
    Odyssey to Qiskit
"""
#path = "circuits/qiskit_to_odyssey/example_002.qpf"
#puzzle = load_oddysey_puzzle(path)
puzzle_text=   "{\"PuzzleDefinition\":{\"ID\":0,\"QubitCapacity\":2,\"GateCapacity\":3,\"SolutionMinimumGates\":4,\"Name\":\"puzz1\",\"InitialState\":[[{\"Real\":1.0,\"Imaginary\":0.0,\"Magnitude\":1.0,\"Phase\":0.0}],[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}],[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}],[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}]],\"FinalState\":[[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}],[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}],[{\"Real\":-0.70710679328816484,\"Imaginary\":0.0,\"Magnitude\":0.70710679328816484,\"Phase\":3.1415926535897931}],[{\"Real\":0.70710679328816484,\"Imaginary\":0.0,\"Magnitude\":0.70710679328816484,\"Phase\":0.0}]],\"FinalBallState\":[[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":3.1415926535897931},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}],[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":3.1415926535897931},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}],[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":-0.70710679328816484,\"Imaginary\":0.0,\"Magnitude\":0.70710679328816484,\"Phase\":3.1415926535897931},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}],[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":3.1415926535897931},{\"Real\":0.70710679328816484,\"Imaginary\":0.0,\"Magnitude\":0.70710679328816484,\"Phase\":0.0}]]},\"PuzzleGateSlots\":[{\"IsGateVisible\":false,\"GateDefinition\":{\"ID\":3,\"Name\":\"X\",\"Type\":3,\"IconPath\":\"Artwork/GatesIcons/XGate\",\"CompatibleQubits\":1,\"DefinitionMatrix\":[[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":1.0,\"Imaginary\":0.0,\"Magnitude\":1.0,\"Phase\":0.0}],[{\"Real\":1.0,\"Imaginary\":0.0,\"Magnitude\":1.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}]]},\"CircuitPosition\":{\"Item1\":0,\"Item2\":0},\"SlaveGatesIDs\":null,\"MasterGateID\":-1,\"OrderInPlacement\":0,\"ID\":1},{\"IsGateVisible\":false,\"GateDefinition\":{\"ID\":5,\"Name\":\"I\",\"Type\":0,\"IconPath\":\"Artwork/GatesIcons/IGate\",\"CompatibleQubits\":1,\"DefinitionMatrix\":[[{\"Real\":1.0,\"Imaginary\":0.0,\"Magnitude\":1.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}],[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":1.0,\"Imaginary\":0.0,\"Magnitude\":1.0,\"Phase\":0.0}]]},\"CircuitPosition\":{\"Item1\":0,\"Item2\":1},\"SlaveGatesIDs\":null,\"MasterGateID\":-1,\"OrderInPlacement\":0,\"ID\":2},{\"IsGateVisible\":false,\"GateDefinition\":{\"ID\":4,\"Name\":\"S\",\"Type\":4,\"IconPath\":\"Artwork/GatesIcons/SGate\",\"CompatibleQubits\":1,\"DefinitionMatrix\":[[{\"Real\":1.0,\"Imaginary\":0.0,\"Magnitude\":1.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}],[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":1.0,\"Magnitude\":1.0,\"Phase\":1.5707963267948966}]]},\"CircuitPosition\":{\"Item1\":0,\"Item2\":2},\"SlaveGatesIDs\":null,\"MasterGateID\":-1,\"OrderInPlacement\":0,\"ID\":3},{\"IsGateVisible\":false,\"GateDefinition\":{\"ID\":5,\"Name\":\"I\",\"Type\":0,\"IconPath\":\"Artwork/GatesIcons/IGate\",\"CompatibleQubits\":1,\"DefinitionMatrix\":[[{\"Real\":1.0,\"Imaginary\":0.0,\"Magnitude\":1.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}],[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":1.0,\"Imaginary\":0.0,\"Magnitude\":1.0,\"Phase\":0.0}]]},\"CircuitPosition\":{\"Item1\":1,\"Item2\":0},\"SlaveGatesIDs\":null,\"MasterGateID\":-1,\"OrderInPlacement\":0,\"ID\":4},{\"IsGateVisible\":false,\"GateDefinition\":{\"ID\":2,\"Name\":\"Y\",\"Type\":5,\"IconPath\":\"Artwork/GatesIcons/YGate\",\"CompatibleQubits\":1,\"DefinitionMatrix\":[[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":-1.0,\"Magnitude\":1.0,\"Phase\":-1.5707963267948966}],[{\"Real\":0.0,\"Imaginary\":1.0,\"Magnitude\":1.0,\"Phase\":1.5707963267948966},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}]]},\"CircuitPosition\":{\"Item1\":1,\"Item2\":1},\"SlaveGatesIDs\":null,\"MasterGateID\":-1,\"OrderInPlacement\":0,\"ID\":5},{\"IsGateVisible\":false,\"GateDefinition\":{\"ID\":0,\"Name\":\"H\",\"Type\":2,\"IconPath\":\"Artwork/GatesIcons/HGate\",\"CompatibleQubits\":1,\"DefinitionMatrix\":[[{\"Real\":0.70710679328816484,\"Imaginary\":0.0,\"Magnitude\":0.70710679328816484,\"Phase\":0.0},{\"Real\":0.70710679328816484,\"Imaginary\":0.0,\"Magnitude\":0.70710679328816484,\"Phase\":0.0}],[{\"Real\":0.70710679328816484,\"Imaginary\":0.0,\"Magnitude\":0.70710679328816484,\"Phase\":0.0},{\"Real\":-0.70710679328816484,\"Imaginary\":0.0,\"Magnitude\":0.70710679328816484,\"Phase\":3.1415926535897931}]]},\"CircuitPosition\":{\"Item1\":1,\"Item2\":2},\"SlaveGatesIDs\":null,\"MasterGateID\":-1,\"OrderInPlacement\":0,\"ID\":6}],\"AvailableGates\":[{\"ID\":1,\"Name\":\"Z\",\"Type\":1,\"IconPath\":\"Artwork/GatesIcons/ZGate\",\"CompatibleQubits\":1,\"DefinitionMatrix\":[[{\"Real\":1.0,\"Imaginary\":0.0,\"Magnitude\":1.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}],[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":-1.0,\"Imaginary\":0.0,\"Magnitude\":1.0,\"Phase\":3.1415926535897931}]]},{\"ID\":3,\"Name\":\"X\",\"Type\":3,\"IconPath\":\"Artwork/GatesIcons/XGate\",\"CompatibleQubits\":1,\"DefinitionMatrix\":[[{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0},{\"Real\":1.0,\"Imaginary\":0.0,\"Magnitude\":1.0,\"Phase\":0.0}],[{\"Real\":1.0,\"Imaginary\":0.0,\"Magnitude\":1.0,\"Phase\":0.0},{\"Real\":0.0,\"Imaginary\":0.0,\"Magnitude\":0.0,\"Phase\":0.0}]]}],\"Tooltips\":[]}"

puzzle=json.loads(puzzle_text)

qc = odyssey_to_qiskit(puzzle, incl_initial_state = False,
                       incl_all_measurements=True)

print(qc.draw('mpl'))


backend = Aer.get_backend('qasm_simulator')
job = execute(qc, backend, shots=1000)
result = job.result()
counts = result.get_counts()
plot_histogram(counts)

print("Done!")